/*
 Creative Commons Attribution-ShareAlike 3.0
 @version 1.0.6
*/
(function(c){function h(d,h){var a=this;this.notifications={loading:"Loading high resolution image...",error:"There has been a problem with loading the image!"};this.settings=c.extend({selector:{preview:"#preview-zoom",window:"#window-zoom"}},h);var e=c("img:first",d),k=null,l=null,m=new Image,g=!1,n=null;this.init=function(b){n="undefined"!=typeof b?b:c(d).attr("data-image");a.reset().attachEventListener()};this.attachEventListener=function(){c(d).on({mouseover:function(){a.start()},mousemove:function(b){a.recognizeMouseMovement(b)},
mouseout:function(b){a.previewRemainsInScope(b)||a.fadeOut()}});return a};this.detachEventListener=function(){c(d).off();return a};this.start=function(){a.modifyCursorAppearance("auto");g?a.showZoomWindow():(a.modifyCursorAppearance("progress"),a.showNotification(a.notifications.loading),a.waitUntilResourceIsLoaded(n))};this.reset=function(){g=!1;return a.fadeOut().detachEventListener()};this.fadeOut=function(){c(a.settings.selector.window).fadeOut();c(a.settings.selector.preview).fadeOut();return a};
this.deferredFadeOut=function(b){setTimeout(function(){a.fadeOut()},b)};this.waitUntilResourceIsLoaded=function(b){m.src=b;c(m).load(function(){g=!0;a.calculateRelationOfImageGeometry(this);a.start()}).error(function(){a.showErrorNotification()});return a};this.showZoomWindow=function(){c(a.settings.selector.window).html(m).fadeIn()};this.showPreview=function(b){c(a.settings.selector.preview).css(b).fadeIn()};this.calculateRelationOfImageGeometry=function(a){l=a.width/e.width();k=a.height/e.height()};
this.recognizeMouseMovement=function(b){if(g)if(a.previewRemainsInScope(b)){var f=(b.pageX-e.offset().left)*l-c(a.settings.selector.window).width()/2,d=(b.pageY-e.offset().top)*k-c(a.settings.selector.window).height()/2;c(a.settings.selector.window).children("img:first").css({left:-f,top:-d});a.showPreview(a.getPositionPropertiesPreview(b));a.showZoomWindow()}else a.fadeOut()};this.getPositionPropertiesPreview=function(b){var f={height:c(a.settings.selector.window).height()/k,width:c(a.settings.selector.window).width()/
l},d=c(e).offsetParent().offset();return c.extend(f,{left:b.pageX-f.width/2-d.left,top:b.pageY-f.height/2-d.top})};this.previewRemainsInScope=function(a){var d=c(e);return a.pageX<d.offset().left||a.pageX>d.offset().left+d.width()||a.pageY<d.offset().top||a.pageY>d.offset().top+d.height()?!1:!0};this.showNotification=function(b){c(a.settings.selector.window).fadeIn().text(b);return a};this.showErrorNotification=function(){a.modifyCursorAppearance("auto").showNotification(a.notifications.error).deferredFadeOut(2E3)};
this.modifyCursorAppearance=function(b){c(d).css("cursor",b);return a};a.init()}c.fn.easyZoom=function(d){return this.each(function(){c.data(this,"easyZoom",new h(this,d))})}})(jQuery);
